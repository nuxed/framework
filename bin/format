#!/usr/bin/env hhvm
<?hh // strict

use namespace HH\Asio;

require __DIR__.'/../vendor/autoload.hack';

<<__EntryPoint>>
async function format(): Awaitable<noreturn> {
  Facebook\AutoloadMap\initialize();

  $source = new Nuxed\Io\Folder(__DIR__ . '/../src/Nuxed');
  $tests = new Nuxed\Io\Folder(__DIR__ . '/../tests/Nuxed');
  $source = await $source->files(true, true);
  foreach ($source as $file) {
    if ($file->path()->extension() === 'hack') {
     exec('hackfmt -i '.$file->path()->toString());
    }
  }
  $tests = await $tests->files(true, true);
  foreach ($tests as $file) {
    if ($file->path()->extension() === 'hack') {
     exec('hackfmt -i '.$file->path()->toString());
    }
  }
  exit(0);
}
